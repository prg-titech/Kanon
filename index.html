<!doctype html>
<html>
    <head>
    	<title>Kanon</title>

    	<link href="node_modules/vis/dist/vis.css" rel="stylesheet" type="text/css"/>
    	<link href="node_modules/jquery-ui-dist/jquery-ui.css" rel="stylesheet" type="text/css"/>
    	<link rel="stylesheet" href="node_modules/split-pane/split-pane.css"/>
    	<link rel="stylesheet" href="node_modules/split-pane/pretty-split-pane.css"/>
    	<link rel="stylesheet" type="text/css" href="src/css/style.css">
    	<link rel="stylesheet" type="text/css" href="src/css/call-tree-network.css">

		<script type="text/javascript" src="src/import.js"></script>

		<style type="text/css">
			html, body {
				height: 100%;
				min-height: 100%;
				margin: 0;
				padding: 0;
			}
		</style>
		<link rel="stylesheet" type="text/css" href="src/css/split-pane.css">

		<script>
            $(function() {
                $('div.split-pane').splitPane();
            });
    	</script>
    </head>
<body>

	<div id="menu-bar">
        <div id="viewMode">
			View Mode:
        	<select name="pullDownViewMode" id="pullDownViewMode">
				<option value="Snapshot">Snapshot</option>
				<option value="Summarized">Summarized</option>
			</select>
		</div>
		<form id='fontSizeForm' name='fontSizeForm'>
			font size: <input id="fontSize" name="fontSize" oninput="__$__.FontSizeUpdate();" placeholder="12">
		</form>
		<div id="autoLayout">
			<input type="checkbox" name="autoLayout" value="true" checked="checked">Auto Layout
		</div>
        <div id="fileOperation">
			<input id="saveButton" type="button" value="Save file"
				   onclick="__$__.saveFile()">
			<input type="file" id="readInput"
				   onclick="__$__.readFile()">
		</div>
		<input id="redrawButton" type="button" value="redraw"
			   onclick="__$__.Update.waitForStabilized = false; __$__.Update.ContextUpdate('changed');">
	</div>
	<div class="pretty-split-pane-frame" id="split-pane-frame"><!-- This div is added for styling purposes only. It's not part of the split-pane plugin. -->
		<div class="split-pane fixed-left" id="split-pane">
			<div class="split-pane-component" id="left-component">
				<div class="pretty-split-pane-component-inner"><!-- This div is added for styling purposes only. It's not part of the split-pane plugin. -->
					<div id="editor">
						<script type="text/javascript" src="src/js/editor.js"></script>
					</div>
				</div>
			</div>
			<div class="split-pane-divider" id="vertical-divider"></div>
			<div class="split-pane-component" id="right-component">
				<div class="split-pane horizontal-percent">
					<div class="split-pane-component" id="top-component">
						<div class="pretty-split-pane-component-inner"><!-- This div is added for styling purposes only. It's not part of the split-pane plugin. -->
							<div id="mynetwork"></div>
						</div>
					</div>
					<div class="split-pane-divider" id="horizontal-divider"></div>
					<div class="split-pane-component" id="bottom-component">
						<div class="pretty-split-pane-component-inner"><!-- This div is added for styling purposes only. It's not part of the split-pane plugin. -->
							<div id="callTree"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id='console'></div>

	<script type="text/javascript" src="src/js/network.js"></script>
	<script type="text/javascript" src="src/js/call-tree-network.js"></script>
	<script>
        __$__.StorePositions.registerPositions();
        __$__.StorePositions.oldNetwork.edges = __$__.edges._data;

        __$__.editor.getSelection().clearSelection();
        __$__.Update.PositionUpdate();

        window.onresize = function(e) {
            __$__.network.redraw();
        };
        document.getElementById('pullDownViewMode').onchange = function() {
            let selectedValue = document.getElementById('pullDownViewMode').value;
			__$__.Context.SwitchViewMode(selectedValue === 'Snapshot');
			__$__.Update.ContextUpdate('changed');
		};
		document.getElementById('autoLayout').onchange = function() {
            __$__.Layout.switchEnabled();
		};
		(() => {
		    var isDragging = false;
            $('div.split-pane')
				.mousedown(function () {
                    isDragging = true;
                })
				.mousemove(function () {
				    if (isDragging) {
                        __$__.network.redraw();
                        __$__.CallTreeNetwork.resize();
					}
				})
				.mouseup(() => {
				    isDragging = false;
				});
        })();
	</script>
</body>
</html>
